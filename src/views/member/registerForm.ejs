<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 화면 중앙에 폼을 정렬 */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; /* 화면 높이를 100%로 설정 */
            margin: 0; /* 기본 여백 제거 */
            font-family: Arial, sans-serif;
        }

        /* 테이블 스타일 */
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 500px; /* 폼의 최대 너비 설정 */
            height: 500px; /* 폼의 고정된 높이 설정 */
            table-layout: fixed; /* 셀 크기를 고정하여 내용이 늘어나지 않게 설정 */
            border: 1px solid #ccc; /* 테이블에 border 설정 */
        }

        td {
            padding: 8px;
            vertical-align: middle;
            text-align: left;
        }

        td label {
            padding-left: 20px;
            display: block; /* label을 블록 요소로 만들어 수평 중앙 정렬 */
            text-align: left; /* 텍스트 왼쪽 정렬 */
            width: 100%; /* label이 td 전체 너비를 차지하도록 설정 */
        }
        td div {
            padding-left: 10px;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%; /* 입력 필드를 테이블 셀 크기에 맞게 설정 */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="submit"] {
            width: 100%; /* 버튼 너비를 100%로 설정하여 테이블 셀 크기에 맞게 설정 */
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px; /* 버튼 글자 크기 */
        }

        input[type="submit"]:hover {
            background-color: #45a049;
        }

        .error-message {
            color: red;
            font-size: 12px;
            min-height: 20px; /* 에러 메시지 영역의 최소 높이를 설정 */
        }

        .error-container {
            min-height: 20px;
        }
    </style>
    <script>
        // 아이디 중복 체크 함수
        function checkIdAvailability() {
            const id = document.getElementById("id").value;
            const idError = document.getElementById("idError");

            // 아이디에 한글과 특수기호가 포함되지 않도록 하는 정규식
            const idRegex = /^[a-zA-Z0-9]+$/;  // 영어와 숫자만 허용

            // 아이디 입력이 비어있지 않으면 유효성 검사 시작
            if (id) {
                if (!idRegex.test(id)) {
                    idError.innerHTML = "아이디는 영어와 숫자만 사용할 수 있습니다.";
                    idError.style.color = "red";
                } else {
                    fetch(`/member/check-id?uid=${id}`)  // 서버의 아이디 중복 체크 API로 요청
                        .then(response => response.json())
                        .then(data => {
                            if (data.isAvailable) {
                                idError.innerHTML = "사용 가능한 아이디입니다.";
                                idError.style.color = "green";  // 중복이 아니면 초록색
                            } else {
                                idError.innerHTML = "이미 사용 중인 아이디입니다.";
                                idError.style.color = "red";  // 중복이 있으면 빨간색
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            idError.innerHTML = "서버 오류가 발생했습니다.";
                            idError.style.color = "red";
                        });
                }
            } else {
                idError.innerHTML = "아이디를 입력해주세요.";
                idError.style.color = "red";
            }
        }

        function checkPwdAvailability(){
            const password = document.getElementById("pwd").value;
            // 비밀번호 길이 검사
            // 비밀번호 유효성 검사 (대문자, 소문자, 숫자, 특수문자 포함)
            const passwordRegex = /^(?=[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
            if (password.length < 8) {
                document.getElementById("passwordError").innerHTML = "비밀번호는 8자 이상이어야 합니다.";
            } else {
                if (!passwordRegex.test(password)) {
                    document.getElementById("passwordError").innerHTML = "비밀번호는 처음 대문자를 시작하고, 소문자, 숫자, 특수문자를 포함해야 합니다.";
                } else {
                    document.getElementById("passwordError").innerHTML = "";
                }
            }
        }

        function checkPwd2Availability(){
            const password = document.getElementById("pwd").value;
            const confirmPassword = document.getElementById("pwd2").value;  // 비밀번호 확인
            // 비밀번호 확인 검사
            if (password !== confirmPassword) {
                document.getElementById("confirmPasswordError").innerHTML = "비밀번호가 일치하지 않습니다.";
            } else {
                document.getElementById("confirmPasswordError").innerHTML = "";
            }
        }

        function checkPhoneAvailability() {
            const phone = document.getElementById("phone").value;
            const phoneRegex = /^010[0-9]{8,9}$/;
            const phoneError = document.getElementById("phoneError");
            if (!phoneRegex.test(phone)) {
                phoneError.innerHTML = "010부터 시작하는 폰번호를 입력하세요.";
            } else {
                phoneError.innerHTML = "";
            }
        }

        function checkAddrAvailability() {
            const addr = document.getElementById("addr").value;
            const addrError = document.getElementById("addrError");
            
            if (!addr) {  // 주소가 비어 있으면
                addrError.innerHTML = "주소를 입력해주세요.";  // 오류 메시지 출력
                addrError.style.color = "red";  // 빨간색으로 오류 표시
            } else {
                addrError.innerHTML = "";  // 주소가 입력되었으면 오류 메시지 삭제
            }
        }

        function checkEmailAvailability() {
            const email = document.getElementById("email").value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const emailError = document.getElementById("emailError");
            if (!emailRegex.test(email)) {
                emailError.innerHTML = "올바른 이메일 주소를 입력하세요.";
            } else {
                emailError.innerHTML = "";
            }
        }

        function checkNameAvailability() {
            const name = document.getElementById("name").value;
            const nameError = document.getElementById("nameError");
            if (!name) {
                nameError.innerHTML = "이름을 입력해주세요.";
                nameError.style.color = "red";
            } else {
                nameError.innerHTML = "";
            }
        }

        function validateForm() {
            const name = document.getElementById("name").value;
            const id = document.getElementById("id").value;
            const password = document.getElementById("pwd").value;
            const confirmPassword = document.getElementById("pwd2").value;
            const phone = document.getElementById("phone").value;
            const email = document.getElementById("email").value;
            const addr = document.getElementById("addr").value;  // 주소 값 추가


            // 각 필드가 비어 있는지 확인
            if (id == "" || password == "" || name == "" || email == "" || phone == "" || addr == "") {
                alert("모든 필드는 필수입니다.");
                return false;  // 모든 필드가 입력되지 않으면 폼 제출을 막음
            }

            // 아이디 유효성 검사
            checkIdAvailability();
            if (document.getElementById("idError").style.color !== "green") {
                alert("아이디 입력을 올바르게 해주세요.");
                return false;
            }

            // 비밀번호 유효성 검사
            checkPwdAvailability();
            if (document.getElementById("passwordError").innerHTML !== "") {
                alert("비밀번호입력을 올바르게 해주세요.");
                return false;  // 비밀번호 오류가 있으면 제출을 막음
            }

            // 비밀번호 확인 유효성 검사
            checkPwd2Availability();
            if (document.getElementById("confirmPasswordError").innerHTML !== "") {
                alert("비밀번호재확인입력을 올바르게 해주세요..");
                return false;  // 비밀번호 확인 오류가 있으면 제출을 막음
            }

            // 전화번호 유효성 검사
            checkPhoneAvailability();
            if (document.getElementById("phoneError").innerHTML !== "") {
                alert("폰 번호 입력을 올바르게 해주세요..");
                return false;  // 전화번호 오류가 있으면 제출을 막음
            }

            // 이메일 유효성 검사
            checkEmailAvailability();
            if (document.getElementById("emailError").innerHTML !== "") {
                alert("이메일 입력을 올바르게 해주세요..");
                return false;  // 이메일 오류가 있으면 제출을 막음
            }

            // 이름 유효성 검사
            checkNameAvailability();
            if (document.getElementById("nameError").innerHTML !== "") {
                alert("이름입력을 올바르게 해주세요..");
                return false;  // 이름 오류가 있으면 제출을 막음
            }

            // 주소 유효성 검사
            checkAddrAvailability();
            if (document.getElementById("addrError").innerHTML !== "") {
                alert("주소 입력을 올바르게 해주세요..");
                return false;  // 주소 오류가 있으면 제출을 막음
            }

            return true;  // 모든 검사를 통과하면 폼 제출
        }


    </script>
</head>
<body>
    <form action="/member/register" method="post" onsubmit="return validateForm()">
        <table>
            <!-- ID -->
            <tr>
                <td><label for="id">아이디 :</label></td>
                <td><input type="text" id="id" name="id" placeholder="ID" onblur="checkIdAvailability()"></td>
                <td><div id="idError" class="error-message error-container"></div></td>
            </tr>

            <!-- Password -->
            <tr>
                <td><label for="pwd">비밀번호:</label></td>
                <td><input type="text" id="pwd" name="pwd" placeholder="Password" onblur="checkPwdAvailability()"></td>
                <td><div id="passwordError" class="error-message error-container"></div></td>
            </tr>

            <!-- Password Confirm -->
            <tr>
                <td><label for="pwd2">비밀번호 재확인:</label></td>
                <td><input type="password" id="pwd2" name="pwd2" placeholder="Confirm Password" onblur="checkPwd2Availability()"></td>
                <td><div id="confirmPasswordError" class="error-message error-container"></div></td>
            </tr>

            <!-- Name -->
            <tr>
                <td><label for="name">이름:</label></td>
                <td><input type="text" id="name" name="name" placeholder="Name" onblur="checkNameAvailability()"></td>
                <td><div id="nameError" class="error-message error-container"></div></td>
            </tr>

            <tr>
                <td><label for="addr">주소:</label></td>
                <td><input type="text" id="addr" name="addr" placeholder="Addr" onblur="checkAddrAvailability()"></td>
                <td><div id="addrError" class="error-message error-container"></div></td>
            </tr>
            <!-- Phone -->
            <tr>
                <td><label for="phone">휴대폰 번호:</label></td>
                <td><input type="text" id="phone" name="phone" placeholder="Phone" onblur="checkPhoneAvailability()"></td>
                <td><div id="phoneError" class="error-message error-container"></div></td>
            </tr>

            <!-- Email -->
            <tr>
                <td><label for="email">이메일:</label></td>
                <td><input type="text" id="email" name="email" placeholder="Email" onblur="checkEmailAvailability()"></td>
                <td><div id="emailError" class="error-message error-container"></div></td>
            </tr>

            <!-- Submit Button (centered with colspan="3") -->
            <tr>
                <td colspan="3" style="text-align: center;">
                    <input type="submit" value="가입">
                </td>
            </tr>
        </table>
    </form>
</body>
</html>
